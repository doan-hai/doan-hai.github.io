<!DOCTYPE html>
<html lang="en-us">
    <head>
		
		<script async src="https://www.googletagmanager.com/gtag/js?id=G-DZTHZZTR25"></script>
		<script>
			window.dataLayer = window.dataLayer || [];
			function gtag(){ dataLayer.push(arguments); }
			gtag('js', new Date());
			gtag('config', 'G-DZTHZZTR25');
		</script>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<title>Cài đặt và cấu hình PostgreSQL Cluster với Patroni cho môi trường Production &middot; Home</title>

		
		<link rel="stylesheet" href="/css/style.css">
		<link rel="stylesheet" href="/css/fonts.css">
		
		<link rel="icon" href="/favicon.ico"/>
		<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
		<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

		
		<link href="" rel="alternate" type="application/rss+xml" title="Home" />
	</head>

    <body>
        		<nav class="nav">
			<div class="nav-container">
				<a href="/">
					
						<h2 class="nav-title">Home</h2>
					
				</a>
				<ul>
    
    
        <li>
            <a href="/design-pattern/">
                
                <span>Design Pattern</span>
                
            </a>
        </li>
    
        <li>
            <a href="/system-architecture/">
                
                <span>System Architecture</span>
                
            </a>
        </li>
    
        <li>
            <a href="/database/">
                
                <span>Database</span>
                
            </a>
        </li>
    
        <li>
            <a href="/certificate/">
                
                <span>Certificate</span>
                
            </a>
        </li>
    
</ul>
			</div>
		</nav>

        

<main>
	<div class="post">
		<h1 class="post-title">Cài đặt và cấu hình PostgreSQL Cluster với Patroni cho môi trường Production</h1>

		<div class="post-info">






        <time datetime="2023-03-23 23:48:05 &#43;0700 &#43;07">
            <span class="catalogue-publishdate">
                <img src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/12.0.4/2/svg/1f4c6.svg" style="width: 1em; height: 1em; margin: 0 0.05em 0 0.1em; vertical-align: -0.1em;" alt="">
            </span>
            March 23, 2023
        </time>
</div>

		<div class="post-container">
			 <div class="catalogue-tag">
    
        
            
            
            
            
            
            
            
        
            <div class="catalogue-tagButton catalogue-tagButton-color8">postgresql</div>
        
        
        
    
        
            
            
            
            
            
            
            
        
        
            <div class="catalogue-tagButton catalogue-tagButton-color9">patroni</div>
        
        
    
        
            
            
            
            
                <div class="catalogue-tagButton catalogue-tagButton-color4">etcd</div>
            
            
            
            
        
        
        
    
        
            
            
            
            
            
            
            
                <div class="catalogue-tagButton catalogue-tagButton-color7">haproxy</div>
            
        
        
        
    
        
            
            
            
            
            
            
            
        
            <div class="catalogue-tagButton catalogue-tagButton-color8">keepalived</div>
        
        
        
    
 </div>

		</div>
		<div class="post-line"></div>

		

		<p>Bài viết này hướng dẫn cách thiết lập một <code>PostgreSQL Cluster</code> với tính sẵn sàng cao (HA - High
Availability) trên môi trường production. Chúng ta sẽ sử dụng các công cụ như <code>Patroni</code>, <code>Etcd</code>,
<code>HAProxy</code> và <code>Keepalived</code> để đảm bảo hệ thống luôn hoạt động ổn định, có khả năng failover tự động và
cân bằng tải
hiệu quả.</p>
<h2 id="giới-thiệu">Giới Thiệu</h2>
<p><code>PostgreSQL</code> là một hệ quản trị cơ sở dữ liệu mạnh mẽ, mã nguồn mở, thích hợp cho các hệ thống lớn.
Việc thiết lập một PostgreSQL Cluster giúp đảm bảo tính sẵn sàng cao (HA - High Availability) và khả
năng mở rộng.</p>
<p>Để triển khai PostgreSQL Cluster, chúng ta sẽ sử dụng các công nghệ sau:</p>
<ul>
<li>
<p><code>Patroni</code>: Một công cụ quản lý PostgreSQL giúp tự động xử lý failover và duy trì trạng thái cluster.</p>
</li>
<li>
<p><code>Etcd</code>: Một hệ thống key-value store phân tán giúp Patroni theo dõi trạng thái của các node trong
cluster.</p>
</li>
<li>
<p><code>HAProxy</code>: Bộ cân bằng tải giúp phân phối kết nối đến node chính xác trong cluster.</p>
</li>
<li>
<p><code>Keepalived</code>: Hỗ trợ tạo địa chỉ IP ảo (VIP) để duy trì khả năng truy cập liên tục ngay cả khi có
failover.</p>
</li>
</ul>
<h2 id="yêu-cầu-hệ-thống">Yêu Cầu Hệ Thống</h2>
<p>Trước khi bắt đầu, cần chuẩn bị các tài nguyên:</p>
<p>Máy chủ: Ít nhất 3 máy chủ (1 Primary, 2 Replica)</p>
<p>Hệ điều hành: Ubuntu 20.04 hoặc RHEL 8</p>
<p>Phiên bản PostgreSQL: PostgreSQL 14 hoặc mới hơn</p>
<p>Công cụ hỗ trợ: Patroni, Etcd, HAProxy
`</p>
<table>
<thead>
<tr>
<th>Cột 1</th>
<th>Cột 2</th>
<th>Cột 3</th>
</tr>
</thead>
<tbody>
<tr>
<td>Dữ liệu 1</td>
<td>Dữ liệu 2</td>
<td>Dữ liệu 3</td>
</tr>
<tr>
<td>Dữ liệu 4</td>
<td>Dữ liệu 5</td>
<td>Dữ liệu 6</td>
</tr>
<tr>
<td>`</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="cài-đặt-postgresql">Cài Đặt PostgreSQL</h2>
<h3 id="cài-đặt-postgresql-trên-mọi-node">Cài Đặt PostgreSQL Trên Mọi Node</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo apt update <span style="color:#000;font-weight:bold">&amp;&amp;</span> sudo apt install -y postgresql postgresql-contrib
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="cấu-hình-postgresql">Cấu Hình PostgreSQL</h3>
<p>Chỉnh sửa tệp postgresql.conf:</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo nano /etc/postgresql/14/main/postgresql.conf
</span></span></code></pre></td></tr></table>
</div>
</div><p>Thay đổi các giá trị sau:</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>listen_addresses = &#39;*&#39;
</span></span><span style="display:flex;"><span>walevel = &#39;replica&#39;
</span></span><span style="display:flex;"><span>synchronous_commit = on
</span></span></code></pre></td></tr></table>
</div>
</div><p>Chỉnh sửa tệp <code>pg_hba.conf</code> để cho phép các node kết nối:</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>host replication all 0.0.0.0/0 md5
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="cài-đặt-patroni">Cài Đặt Patroni</h2>
<p>Patroni là một công cụ quản lý PostgreSQL tự động failover.</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pip install patroni<span style="color:#000;font-weight:bold">[</span>etcd<span style="color:#000;font-weight:bold">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Cấu hình <code>patroni.yml</code> cho từng node:</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>scope: postgres_cluster
</span></span><span style="display:flex;"><span>name: node1
</span></span><span style="display:flex;"><span>restapi:
</span></span><span style="display:flex;"><span>  listen: 0.0.0.0:8008
</span></span><span style="display:flex;"><span>  connect_address: 192.168.1.1:8008
</span></span><span style="display:flex;"><span>etcd:
</span></span><span style="display:flex;"><span>  hosts: 192.168.1.2:2379,192.168.1.3:2379
</span></span><span style="display:flex;"><span>postgresql:
</span></span><span style="display:flex;"><span>  listen: 0.0.0.0:5432
</span></span><span style="display:flex;"><span>  connect_address: 192.168.1.1:5432
</span></span><span style="display:flex;"><span>  data_dir: /var/lib/postgresql/14/main
</span></span><span style="display:flex;"><span>  pg_hba:
</span></span><span style="display:flex;"><span>    - host replication all 0.0.0.0/0 md5
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="cài-đặt-etcd">Cài Đặt Etcd</h2>
<p>Etcd giúp quản lý cấu hình cluster:</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo apt install etcd
</span></span></code></pre></td></tr></table>
</div>
</div><p>Cấu hình <code>etcd.conf</code> trên mọi node:</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>ETCD_LISTEN_PEER_URLS=&#34;http://0.0.0.0:2380&#34;
</span></span><span style="display:flex;"><span>ETCD_LISTEN_CLIENT_URLS=&#34;http://0.0.0.0:2379&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>Khởi động dịch vụ:</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo systemctl start etcd <span style="color:#000;font-weight:bold">&amp;&amp;</span> sudo systemctl <span style="color:#0086b3">enable</span> etcd
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="cấu-hình-haproxy">Cấu Hình HAProxy</h2>
<p>HAProxy giúp cân bằng tải các kết nối đến PostgreSQL:</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo apt install haproxy
</span></span></code></pre></td></tr></table>
</div>
</div><p>Chỉnh sửa <code>haproxy.cfg</code>:</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>frontend postgres_frontend
</span></span><span style="display:flex;"><span>  bind *:5000
</span></span><span style="display:flex;"><span>  mode tcp
</span></span><span style="display:flex;"><span>  default_backend postgres_backend
</span></span><span style="display:flex;"><span>backend postgres_backend
</span></span><span style="display:flex;"><span>  mode tcp
</span></span><span style="display:flex;"><span>  balance roundrobin
</span></span><span style="display:flex;"><span>  server node1 192.168.1.1:5432 check
</span></span><span style="display:flex;"><span>  server node2 192.168.1.2:5432 check
</span></span></code></pre></td></tr></table>
</div>
</div><p>Khởi động HAProxy:</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo systemctl restart haproxy
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="kiểm-tra-và-giám-sát">Kiểm Tra Và Giám Sát</h2>
<p>Sử dụng <code>patronictl</code> để kiểm tra trạng thái cluster:</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>patronictl -c /etc/patroni.yml list
</span></span></code></pre></td></tr></table>
</div>
</div><p>Sử dụng pg_isready để kiểm tra kết nối:</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pg_isready -h localhost -p <span style="color:#099">5000</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="kết-luận">Kết Luận</h2>
<p>Bằng cách sử dụng Patroni, Etcd và HAProxy, ta có thể triển khai PostgreSQL Cluster với tính sẵn
sàng cao, đảm bảo hệ thống hoạt động ổn định và có khả năng tự phục hồi khi xảy ra lỗi.</p>
<div class="toggle-wrapper">
  <p>
    <button
        onclick="toggleContent(this)"
        data-label-show="Xem thêm"
    data-label-hide="Thu gọn"
    >
    Xem thêm
    </button>
  </p>
  <div class="toggle-content" style="display: none;">
    
Đây là nội dung chi tiết cần được ẩn/hiện theo yêu cầu.

  </div>
</div>

<script>
  function toggleContent(button) {
    const wrapper = button.closest(".toggle-wrapper");
    const content = wrapper.querySelector(".toggle-content");
    const isHidden = window.getComputedStyle(content).display === "none";

    content.style.display = isHidden ? "block" : "none";

    const labelShow = button.getAttribute("data-label-show");
    const labelHide = button.getAttribute("data-label-hide");
    button.innerText = isHidden ? labelHide : labelShow;
  }
</script>


		
	</div>

	<div class="pagination">
		<a href="/certificate/saa-c03-certification-exam-review-questions/" class="left arrow">&#8592;</a>

		<a href="#" class="top">Top</a>
	</div>

	<script src="https://giscus.app/client.js"
					data-repo="doan-hai/blog-comments"
					data-repo-id="R_kgDOOkmWoA"
					data-category="General"
					data-category-id="DIC_kwDOOkmWoM4Cpx-O"
					data-mapping="pathname"
					data-strict="0"
					data-reactions-enabled="1"
					data-emit-metadata="0"
					data-input-position="bottom"
					data-theme="preferred_color_scheme"
					data-lang="vi"
					crossorigin="anonymous"
					async>
	</script>
</main>


        		<footer>
			
			<span>
			&copy; <time datetime="2025-05-13 16:38:19.567424 &#43;0700 &#43;07 m=&#43;0.132871501">2025</time> Đoàn Hải. Made with <a href='https://gohugo.io'>Hugo</a>.
			</span>
		</footer>


        
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    </body>
</html>
